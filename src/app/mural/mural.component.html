<app-header></app-header>

<main class="main-mural">

    <!-- HERO DO MURAL -->
    <section class="mural-hero">
        <h1>Mural da Comunidade</h1>
        <p>Descubra projetos incr√≠veis da comunidade indie e compartilhe suas pr√≥prias cria√ß√µes</p>
        
        <button class="btn-add-projeto" (click)="abrirModal()">
            + Adicionar Projeto
        </button>
    </section>

    <!-- BARRA DE FILTROS -->
    <section class="mural-filtros">
        <div class="filtros-container">
            
            <div class="filtro-grupo esticado">
                <label>Buscar Projetos</label>
                <div class="input-icon">
                    <span class="lupa">üîç</span>
                    <input type="text" placeholder="Nome, autor ou tags..." [(ngModel)]="textoBusca">
                </div>
            </div>

            <div class="filtro-grupo">
                <label>G√™nero</label>
                <select [(ngModel)]="filtroGenero">
                    <option value="">Todos</option>
                    <option value="RPG">RPG</option>
                    <option value="A√ß√£o">A√ß√£o</option>
                    <option value="Aventura">Aventura</option>
                    <option value="Plataforma">Plataforma</option>
                    <option value="Estrat√©gia">Estrat√©gia</option>
                    <option value="Simula√ß√£o">Simula√ß√£o</option>
                    <option value="Sci-Fi">Sci-Fi</option>
                </select>
            </div>

        </div>
    </section>

    <!-- GRID DE PROJETOS -->
    <section class="projetos-section">
        <div class="projetos-grid">
            <div class="card-projeto" *ngFor="let projeto of projetosFiltrados" (click)="abrirDetalhes(projeto)">
                
                <!-- BOT√ïES DE A√á√ÉO -->
                <div class="card-actions">
                    <button class="btn-icon editar" (click)="prepararEdicao(projeto, $event)">‚úèÔ∏è</button>
                    <button class="btn-icon excluir" (click)="deletarProjeto(projeto, $event)">üóëÔ∏è</button>
                </div>

                <div class="projeto-capa">
                    <img [src]="projeto.imagem" alt="Capa do Jogo">
                    <span class="status-tag" [class]="projeto.statusClass">{{ projeto.status }}</span>
                </div>
                <div class="projeto-content">
                    <div class="projeto-header">
                        <h3>{{ projeto.titulo }}</h3>
                        <span class="autor">por <strong>{{ projeto.autor }}</strong></span>
                    </div>
                    <p class="descricao">{{ projeto.descricao }}</p>
                    <div class="tags-list">
                        <span class="tag" *ngFor="let tag of projeto.tags">{{ tag }}</span>
                    </div>
                    <div class="card-footer">
                        <span class="genero-label">{{ projeto.genero }}</span>
                        <div class="social-stats">
                            <button class="btn-like" [class.liked]="projeto.curtido" (click)="toggleLike(projeto, $event)">
                                <span class="coracao">‚ù§</span> {{ projeto.likes }}
                            </button>
                            <span>üí¨ {{ projeto.comentarios }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ============================================================ -->
    <!-- MODAL: ADICIONAR/EDITAR PROJETO -->
    <!-- ============================================================ -->
    <div class="modal-overlay" *ngIf="modalAberto">
        <div class="modal-janela">
            
            <div class="modal-header">
                <h2>{{ indexEdicao > -1 ? 'Editar Projeto' : 'Adicionar Projeto' }}</h2>
                <button (click)="fecharModal()">‚úñ</button>
            </div>

            <div class="modal-body">
                <!-- Nome -->
                <div class="form-group">
                    <label>Nome do Projeto <span class="asterisco">*</span></label>
                    <input type="text" [(ngModel)]="novoProjeto.titulo" placeholder="Nome do seu jogo">
                </div>

                <!-- G√™nero e Status -->
                <div class="form-row">
                    <div class="form-group">
                        <label>G√™nero <span class="asterisco">*</span></label>
                        <select [(ngModel)]="novoProjeto.genero">
                            <option value="">Selecione o g√™nero</option>
                            <option value="RPG">RPG</option>
                            <option value="A√ß√£o">A√ß√£o</option>
                            <option value="Aventura">Aventura</option>
                            <option value="Plataforma">Plataforma</option>
                            <option value="Terror">Terror</option>
                            <option value="Simula√ß√£o">Simula√ß√£o</option>
                            <option value="Sci-Fi">Sci-Fi</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select [(ngModel)]="novoProjeto.status">
                            <option value="Em Desenvolvimento">Em Desenvolvimento</option>
                            <option value="Beta">Beta (Testes)</option>
                            <option value="Lan√ßado">Lan√ßado</option>
                        </select>
                    </div>
                </div>

                <!-- Descri√ß√£o -->
                <div class="form-group">
                    <label>Descri√ß√£o <span class="asterisco">*</span></label>
                    <textarea rows="4" [(ngModel)]="novoProjeto.descricao" placeholder="Descreva seu projeto..."></textarea>
                </div>

                <!-- URL da Foto -->
                <div class="form-group">
                    <label>URL da Foto de Capa</label>
                    <input type="text" [(ngModel)]="novoProjeto.imagem" placeholder="https://exemplo.com/imagem.jpg">
                    <small style="color: #6b7280; font-size: 0.8rem;">Cole o link da imagem de capa do seu projeto</small>
                </div>

                <!-- Link do V√≠deo -->
                <div class="form-group">
                    <label>Link do V√≠deo (YouTube)</label>
                    <input type="text" [(ngModel)]="novoProjeto.video" placeholder="https://www.youtube.com/watch?v=...">
                    <small style="color: #6b7280; font-size: 0.8rem;">Cole o link do v√≠deo do YouTube do seu projeto</small>
                </div>

                <!-- Tags -->
                <div class="form-group">
                    <label>Tags (separadas por v√≠rgula)</label>
                    <input type="text" [(ngModel)]="novoProjeto.tagsInput" placeholder="ex: Fantasy, Magic, Adventure">
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-cancelar" (click)="fecharModal()">Cancelar</button>
                <button class="btn-salvar" (click)="salvarProjeto()">
                    {{ indexEdicao > -1 ? 'Salvar Altera√ß√µes' : 'Adicionar' }}
                </button>
            </div>

        </div>
    </div>

    <!-- MODAL DE DETALHES (Mantenha o que j√° existe no seu c√≥digo ou adicione se faltar) -->
    <div class="modal-overlay" *ngIf="modalDetalhesAberto && projetoSelecionado">
        <div class="modal-janela modal-largo">
            <div class="modal-header">
                <h2>{{ projetoSelecionado.titulo }}</h2>
                <button (click)="fecharDetalhes()">‚úñ</button>
            </div>
            <div class="modal-body">
                <div class="media-container">
    <iframe 
        *ngIf="projetoSelecionado.videoSafe" 
        [src]="projetoSelecionado.videoSafe" 
        title="YouTube video player"
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
        referrerpolicy="strict-origin-when-cross-origin"
        allowfullscreen>
    </iframe>
    
    <img *ngIf="!projetoSelecionado.videoSafe" [src]="projetoSelecionado.imagem" alt="Capa Grande">
</div>
                <div class="detalhes-info">
                    <div class="status-badge" [class]="projetoSelecionado.statusClass">{{ projetoSelecionado.status }}</div>
                    <span class="genero-tag">{{ projetoSelecionado.genero }}</span>
                    <span class="autor">Criado por <strong>{{ projetoSelecionado.autor }}</strong></span>
                </div>
                <p class="descricao-completa">{{ projetoSelecionado.descricao }}</p>
                <div class="tags-list">
                    <span class="tag" *ngFor="let tag of projetoSelecionado.tags">{{ tag }}</span>
                </div>
                <div class="area-comentarios">
                    <h3>Coment√°rios ({{ projetoSelecionado.listaComentarios.length }})</h3>
                    <div class="lista-msgs">
                        <div class="msg-item" *ngFor="let comentario of projetoSelecionado.listaComentarios">
                            <div class="avatar-mini">üë§</div>
                            <div class="balao-msg"><strong>Usu√°rio</strong><p>{{ comentario }}</p></div>
                        </div>
                        <p *ngIf="projetoSelecionado.listaComentarios.length === 0" class="sem-comentarios">Seja o primeiro a comentar!</p>
                    </div>
                    <div class="input-comentario">
                        <input type="text" placeholder="Escreva um coment√°rio..." [(ngModel)]="novoComentario" (keyup.enter)="adicionarComentario()">
                        <button (click)="adicionarComentario()">Enviar</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="social-stats-grande">
                     <button class="btn-like grande" [class.liked]="projetoSelecionado.curtido" (click)="toggleLike(projetoSelecionado, $event)">
                        <span class="coracao">‚ù§</span> {{ projetoSelecionado.likes }} Curtidas
                    </button>
                </div>
                <button class="btn-cancelar" (click)="fecharDetalhes()">Fechar</button>
            </div>
        </div>
    </div>

</main>